      SUBROUTINE ITF(ARY,NST,NND,H,YM1,YNP1,KY,ER,SM,KRT)  
C     VERSION OF 8/11/83
C     SRT TO CHOOSE THE PROPER INTEGRATION RULE AND TO DO A NUMERICAL    
C     INTEGRATION
C     ARY IS THE NAME OF THE ARRAY CONTAINING ORDINATES    
C     NST IS THE ORDINAL LOCATION TO START INTEGRATION IN ARY     
C     NND IS THE ORDINAL LOCATION OF THE FINAL ORDINATE TO USE IN ARY    
C     H IS THE INCREMENT
C     KY IS A CONTROL INTEGER.IF KY=0,DO NOT CALCULATE THE ERROR IN      
C     THE INTEGRATION,OTHERWISE YES   
C     ER IS THE CALCULATED ERROR,IF SPECIFIED
C     SM IS THE INTEGRATION VALUE     
C     KRT IS AN INDICATOR OF ACCURACY FOR COMBINED INTEGRATIONS   
C     THE LARGER THE VALUE OF KRT,THE LOWER THE PROBABLE ACCURACY 
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION ARY(300) 
      KRT=0      
      SM=0.D0
      ER=0.D0    
      IF (H.EQ.0.D0) GO TO 99   
      N=NND-NST  
      IF (N.EQ.0) GO TO 99     
      KST=NST    
      KND=NND    
      K=MOD(N,2) 
C    IF K.EQ.0,N IS EVEN
      IF (K.EQ.0) GO TO 10     
      KRT=1      
      IF (DABS(ARY(KST)).GT.DABS(ARY(KND))) GO TO 5   
      SM=0.5D0*(ARY(KST)+ARY(KST+1))*H+SM      
      N=N-1      
      IF (N.EQ.0) GO TO 99     
      KST=KST+1  
      GO TO 10   
    5 SM=0.5D0*H*(ARY(KND-1)+ARY(KND))+SM      
      N=N-1      
      IF (N.EQ.0) GO TO 99     
      KND=KND-1  
   10 CALL SMP(ARY,KST,KND,H,YM1,YNP1,KY,ER1,150,SM1)   
      ER=ER+ER1  
      SM=SM+SM1  
   99 RETURN     
      END 
