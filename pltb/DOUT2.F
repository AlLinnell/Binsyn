      SUBROUTINE DOUT2(AGLMT1,I,IEC,IFC,ISV,AGLMT2,
     $IRC,NKP,XG,YG,ICOUNT,LCT,XCM,YCM,XNKSV1,YNKSV1,
     $XNKSV2,YNKSV2,CSPJ,ISEQ,SNPJ,AGL2,KS,NOUT1,NOUT7,NOUT10)
	INCLUDE 'COMA.FOR'
      DIMENSION LCT(16),AR2(3),AR3(3)
      DATA PIO2/1.5707963267949D0/
      DATA ANG/6.29D0/
	DATA ERLT/1.D-13/
C*********************************************************************
C     DRAW OUTLINE      
C*********************************************************************
C  
C    IF I=ISV,WE HAVE THE STAR AT THE ORIGIN OF COODS.     
C  
C
  193 FORMAT (2F12.5)
C    DO SMALL THETA BRANCH     
C
C
C     If orbital inclination is small enough,two segments of small
C     theta branch may show.
C     DIVIDE SMALL THETA BRANCH INTO TWO SEGMENTS IF NECESSARY    
C     THE PROGRAM LOOP THROUGH STATEMENT 235 IS THE INITIAL SEGMENT      
C  
C  
      K=0
C     Take alternate route if there is no eclipse
      IF ((DABS(AGLMT1+ANG).LE.ERLT).AND.(I.NE.IEC)) GO TO 316
      DO 235 J=1,IRC-1
      AGL1=ALP(J,2)
      RG=(ALP(J+1,2)-ALP(J,2))/16.0D0 
      JLM=16
      JKL=0
      IF (K.GT.0) GO TO 234
      JLM=17
      JKL=1
  234 IF ((AGLMT2.LT.ALP(J,2)).AND.(AGLMT2.GT.ALP(J+1,2))) GO TO 236
      GO TO 241
  236 JLM=16
      JKL=0
  241 DO 423 JJ=1,JLM
      CFF=JJ-JKL
      ANGLE=AGL1+CFF*RG
C      IF ((ANGLE.GT.ALP(1,2)).OR.(ANGLE.LT.ALP(IRC,2))) GO TO 423
      JRF=2
      IF (NKP.LE.1) GO TO 257
      IF ((ANGLE.LT.ALP(1,3)).AND.(ANGLE.GE.AGL2)) JRF=3
      IF (DABS(ANGLE-AGL2).LT.1.0D-13) JRF=3
  257 IF (ICOUNT.EQ.ISV) GO TO 223    
      IF ((DABS(AGLMT1-ANG).LE.ERLT).AND.(DABS(AGLMT2-ANG).LE.ERLT)) 
     $GO TO 223
      IF (ISV.EQ.IEC) GO TO 290
      IF ((AGLMT1.GE.0.0D0).AND.(AGLMT2.GE.0.0D0)) GO TO 251
      IF ((AGLMT1.LT.0.0D0).AND.(AGLMT2.LT.0.0D0)) GO TO 252
      IF ((AGLMT2.LT.0.0D0).AND.(AGLMT1.GE.0.0D0)) GO TO 253
      IF ((AGLMT2.GE.0.0D0).AND.(AGLMT1.LT.0.0D0)) GO TO 255
      CALL PMDSTOP      
  251 IF (ANGLE.GE.AGLMT1) GO TO 223
      GO TO 423
  252 IF (ANGLE.GE.AGLMT1) GO TO 223  
      GO TO 423  
  253 IF (DABS(AGLMT2).LT.PIO2) GO TO 254
      IF (ANGLE.GE.AGLMT2) GO TO 223
      GO TO 423  
  254 IF (ANGLE.GE.AGLMT2) GO TO 423
      GO TO 223
  255 IF (AGLMT1.GT.-PIO2) GO TO 256  
      IF (ANGLE.GE.AGLMT1) GO TO 223  
      GO TO 423  
  256 IF (ANGLE.GE.AGLMT1) GO TO 223  
      GO TO 423  
  290 IF ((AGLMT1.GE.0.0D0).AND.(AGLMT2.GE.0.0D0)) GO TO 292
      IF ((AGLMT1.LT.0.0D0).AND.(AGLMT2.LT.0.0D0)) GO TO 293
      IF ((AGLMT2.LT.0.0D0).AND.(AGLMT1.GE.0.0D0)) GO TO 294
      IF ((AGLMT2.GE.0.0D0).AND.(AGLMT1.LT.0.0D0)) GO TO 295
      CALL PMDSTOP      
  292 IF (ANGLE.GE.AGLMT1) GO TO 223
      GO TO 423
  293 IF (ANGLE.GE.AGLMT1) GO TO 223  
      GO TO 423  
  294 IF (AGLMT2.GT.-PIO2) GO TO 296  
      IF ((ANGLE.LE.AGLMT1).AND.(ANGLE.GE.AGLMT2)) GO TO 223
      GO TO 423 
  296 IF ((ANGLE.GE.AGLMT2).AND.(ANGLE.LE.AGLMT1)) GO TO 223  
      GO TO 423 
  295 IF (AGLMT1.GT.-PIO2) GO TO 297  
      IF ((ANGLE.LT.AGLMT1).OR.(ANGLE.GT.AGLMT2)) GO TO 423  
      GO TO 223  
  297 IF ((ANGLE.LT.AGLMT1).OR.(ANGLE.GT.AGLMT2)) GO TO 423  
      GO TO 223
  223 CONTINUE
      CALL RHO(ANGLE,ARYA,ARYB,ARYC,ALP,RS,JRF,IRC,IFC,NKP,VRHO)
      A=VRHO*DCOS(ANGLE)
      B=VRHO*DSIN(ANGLE)
      YP=A
      IF ((I.NE.ISV).AND.(ISEQ.LT.3)) YP=-YP
      IF ((I.EQ.ISV).AND.(ISEQ.GT.2)) YP=-YP
      XP=B
      IF (I.EQ.ISV) GO TO 225  
      IF (ISV.NE.IEC) GO TO 245
      YP=YP-YG   
      XP=XP-XG   
      GO TO 225
  245 YP=YP+YG   
      XP=XP+XG   
  225 CONTINUE   
      K=K+1      
      XV(K)=XP   
      YV(K)=YP   
   93 IF (LCT(15).EQ.1) GO TO 423
      YV(K)=XP*CSPJ-YP*SNPJ    
      XV(K)=XP*SNPJ+YP*CSPJ    
  423 CONTINUE
  235 CONTINUE   
  226 IF ((ICOUNT.EQ.2).AND.(LCT(4).NE.1)) GO TO 316
      IF ((ICOUNT.EQ.1).AND.(LCT(12).NE.1)) GO TO 316
	IF (KS.GT.1) GO TO 316
C     Draw outline
      IF (ICOUNT.EQ.1) THEN
		DO L=1,K
		X=XV(L)
		Y=YV(L)
		WRITE (NOUT7, 193) X-XCM, -Y+YCM
		END DO
	END IF
      IF (ICOUNT.EQ.2) THEN
		DO L=1,K
		X=XV(L)
		Y=YV(L)
		WRITE (NOUT10, 193) X-XCM, -Y+YCM
		END DO
	END IF
C     DRAW CONNECTING LINE TO PROPER POINT ON NECK OF OTHER COMPONENT
      IF (ICOUNT.EQ.1) GO TO 316
      IF ((DABS(AGLMT1-ANG).LE.ERLT).AND.(DABS(AGLMT2-ANG).LE.ERLT)) 
     $GO TO 258
      GO TO 316
  258 IF (NKP.LE.1) GO TO 316
      X=XV(K)
      Y=YV(K)
      D1=DSQRT((XV(K)-XNKSV1)**2+(YV(K)-YNKSV1)**2)
      D2=DSQRT((XV(K)-XNKSV2)**2+(YV(K)-YNKSV2)**2)
      IF (D1.LT.D2) X=XNKSV1
      IF (D2.LT.D1) X=XNKSV2
      IF (D1.LT.D2) Y=YNKSV1
      IF (D2.LT.D1) Y=YNKSV2
      D1=DSQRT((X-XCM)**2+(Y-YCM)**2)
      IF (D1.LT.0.02) THEN
		IF (ICOUNT.EQ.1) WRITE (NOUT7, 193) X-XCM, -Y+YCM
		IF (ICOUNT.EQ.2) WRITE (NOUT10, 193) X-XCM, -Y+YCM
      END IF   
  316 CONTINUE
      RETURN
  100 DO 110 J=1,IRC-1
      AR3(1)=ALP(J,2)
	AR3(2)=ALP(J+1,2)
	AR2(1)=RS(J,2)
	AR2(2)=RS(J+1,2)
	CALL STLINE(AR3,AR2,0,IER)
	IF (IER.EQ.129) CALL PMDSTOP
      AGL1=ALP(J,2)
	RG=(ALP(J+1,2)-ALP(J,2))/16.D0
	JLM=16
	JKL=0
	IF (K.GT.0) GO TO 101
	JLM=17
	JKL=1
  101 DO 120 JJ=1,JLM
      CFF=JJ-JKL
	ANGLE=AGL1+CFF*RG
	VRHO=AR2(1)+AR2(2)*ANGLE
      A=VRHO*DCOS(ANGLE)
      B=VRHO*DSIN(ANGLE)
      YP=A
      IF ((I.NE.ISV).AND.(ISEQ.LT.3)) YP=-YP
      IF ((I.EQ.ISV).AND.(ISEQ.GT.2)) YP=-YP
      XP=B
      IF (I.EQ.ISV) GO TO 102  
      IF (ISV.NE.IEC) GO TO 103
      YP=YP-YG   
      XP=XP-XG
	GO TO 102
  103 YP=YP+YG
      XP=XP+XG
  102 CONTINUE
      K=K+1
	XV(K)=XP
	YV(K)=YP
	IF (LCT(15).EQ.1) GO TO 110
	YV(K)=XP*CSPJ-YP*SNPJ
	XV(K)=XP*SNPJ+YP*CSPJ
  120 CONTINUE
  110 CONTINUE
      GO TO 226
      END
