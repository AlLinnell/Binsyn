      SUBROUTINE SHDMN(I,ITH,N,ER,TARY,
     $IRC,IFC,NKP,XC,YC,ISV,ERAV,VNAV,PHMN,EMN,IRD,NOUT)
C     SRT TO LOCATE THE PHI VALUE ON THETA PROFILE ITH FOR WHICH ERMN    
C     IS A LOCAL MINIMUM
      INCLUDE 'COMA.FOR'
      DIMENSION AR2(MTHM),AR3(MTHM),ERAV(MTHM),VNAV(MTHM)
	DATA ERLT/1.D-13/
      EMN=ERAV(1)
      PHMN=VNAV(1)
      JMN=1
      DO 10 J=2,N
      IF (ERAV(J).GE.EMN) GO TO 10
      EMN=ERAV(J)
      PHMN=VNAV(J)
      JMN=J
   10 CONTINUE
      IF ((JMN.NE.1).AND.(JMN.NE.N)) GO TO 20
      IF (JMN.EQ.1) GO TO 11
      EMN=ERAV(N)
      PHMN=VNAV(N)
      JMN=N
   11 RETURN
   20 JST=JMN-2
   21 JST=JST+1
      IF (JST.GE.1) GO TO 22
      GO TO 21
   22 IF ((JST+1).LE.N) GO TO 23
      JST=JST-1
      GO TO 22
   23 IF (JST.LT.1) CALL PMDSTOP
      DO 24 J=1,3
      AR3(J)=VNAV(JST+J-1)
      AR2(J)=ERAV(JST+J-1)
   24 CONTINUE
      CALL PARAB(AR3,AR2)
   25 IF (DABS(AR2(3)).LE.ERLT) GO TO 26
      PHMN=-AR2(2)/2.0D0/AR2(3)
      CALL ERTS(I,ITH,PHMN,ER,TARY,IRC,
     $IFC,NKP,XC,YC,AGL,RDS,VRH0,ISV,JJ,IRD)
      EMN=VRH0-RDS
      GO TO 11
   26 DV=0.5D0
      DO 29 K=1,2
      DV=DV*2.0D0
      DPH=(VNAV(JST+1)-VNAV(JST))/DV
      STPH=PHMN-DPH*2.0D0
      DO 27 J=1,3
      AR3(J)=STPH+J*DPH
      CALL ERTS(I,ITH,AR3(J),ER,TARY,IRC,
     $IFC,NKP,XC,YC,AGL,RDS,VRH0,ISV,JJ,IRD)
      AR2(J)=VRH0-RDS
      IF (EMN.LT.AR2(J)) GO TO 27
      EMN=AR2(J)
      PHMN=AR3(J)
   27 CONTINUE
      CALL PARAB(AR3,AR2)
   28 IF (DABS(AR2(3)).LE.ERLT) GO TO 11
      PHMN=-AR2(2)/2.0D0/AR2(3)
      CALL ERTS(I,ITH,PHMN,ER,TARY,IRC,
     $IFC,NKP,XC,YC,AGL,RDS,VRH0,ISV,JJ,IRD)
      EMN=VRH0-RDS
   29 CONTINUE
      GO TO 11
      END 
