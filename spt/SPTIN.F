      SUBROUTINE SPTIN(NOUT1,NOUT16)
      INCLUDE 'COMA.FOR'
      INCLUDE 'COMM.FOR'
      DIMENSION VH(13),LDF(13),KCT(13),LV(13)
C
      DIMENSION DPHS(MWL),PHAS(MWL),RFMG(MWL)
      DIMENSION VGMD(MTW,MWL,MSPT),VLMD(MTW,MSPT)
      DIMENSION CBT(MTW,MSPT)
      DIMENSION VK(MTW,MWL,MSPT)
      DIMENSION SNB(MTW,MSPT)
C
      DIMENSION SMC(MPHS),SME(MPHS)
      DIMENSION PSJ(MPHS),VCLC(MPHS)
C
	DIMENSION VMAG(MOBS,MWL),PHSP(MOBS,MWL),WT(MOBS,MWL)
C
      COMMON /CQ/ FMT,FXSP,PHSV,IWL,KJP,KSP,IC,JL,CBT,NRY11,VH,LL,SNB,
     $SMC,VK,LV,SME,VCLC,MDAT,NRY2,PHAS,RFMG,PSJ,NRY5,KPT,KSQ,DPHS,NRY8
     $,SURF1,VGMD,IWR,SURF2,NSPA,NSPB,PHSEC,VLMD,VMXX,NRY1,NRY3,NRY4,
     $NRY6,NRY7,NRY9,NRY10,NRY12,LDF,VMAG,PHSP,WT
      SAVE /CQ/
C
      CHARACTER FMT*80
      DATA TWPI/6.2831853071796D0/
      DATA CV/-1.0857362D0/
  109 FORMAT (2F15.8,3D20.7)
  115 FORMAT (1X,'READ ERROR ON RECORD IC=',I5,5X,'IWL VALUE=',I5)
  119 FORMAT (1H )
  127 FORMAT (1X,'PHASE INTERVAL FROM POINT',I5,2X,'TO',I5,2X,'IS',
     $F10.8,2X,'WHILE STD.INTERVAL IS',F10.8)
  128 FORMAT (1X,'HORIZONTAL DIFFERENCE TABLE FOR PHASE INTERVAL',F10.7
     $,2X,'TO',F10.7)
  129 FORMAT (1X,'TOO FEW TABULAR VALUES FOR DIFFERENCE TABLE',/,1X,
     $'NUMBER OF TABULAR VALUES=',I5)
C
C     VMAG IS AN OBSERVED MAGNITUDE   
C     OBSL IS THE CORRESPONDING LIGHT LEVEL,AFTER SUBTRACTION OF THE     
C     REFERENCE MAGNITUDE      
C     PHSP IS THE CORRESPONDING PHASE,AS A FRACTION OF AN ORBIT   
      KJP=0
C     Set PHSECT  as fraction of a period, where PHSEC is the orbital
C     phase (not phase angle) of mid-secondary minimum.
      PHSECT=PHSEC/TWPI
 1000 FORMAT (10I5)
 1001 FORMAT (10F8.5)
 1002 FORMAT (' ')
 1003 FORMAT ('SPTIN')
 1004 FORMAT (4D17.6)
 1005 FORMAT (4D20.13)
C      WRITE (NOUT1,1003)
 210  OBSL=DEXP((VMAG(IC,IWL)-RFMG(IWL))/CV)   
      IF (OBSL.GT.5.D0) OBSL=5.D0
C     PHS IS THE PHASE PHSP EXPRESSED IN RADIANS
      PHS=PHSP(IC,IWL)*TWPI
   42 IF (PHS.GE.0.D0) GO TO 41 
      PHS=PHS+TWPI      
      GO TO 42   
   41 IF (PHS.LE.TWPI) GO TO 48
      PHS=PHS-TWPI      
      GO TO 41   
C  
C     CLASSIFY OBSERVATION INTO SEPARATE COMPUTED SECTIONS OF
C     THEORETICAL LIGHT CURVE
C
C
   48 IF ((PHS.GE.VH( 1)).AND.(PHS.LT.VH( 2))) THEN
         IF (PHSP(IC,IWL).LT.PHSV) LDF(1)=0
         PHSV=PHSP(IC,IWL)
         CALL VINTER(PHS,VLIGHT,VLC,PSJ,VCLC,SMC,SME,LDF(1),NRY1,LV(1)
     $   ,KSP,KPT,1,KCT,NOUT1)
         GO TO 68
      END IF
      IF ((PHS.GE.VH( 2)).AND.(PHS.LT.VH( 3))) THEN
         IF (PHSP(IC,IWL).LT.PHSV) LDF(2)=0
         PHSV=PHSP(IC,IWL)
         CALL VINTER(PHS,VLIGHT,VLC,PSJ,VCLC,SMC,SME,LDF(2),NRY2,LV(2)
     $   ,KSP,KPT,2,KCT,NOUT1)
         GO TO 68
      END IF
      IF ((PHS.GE.VH( 3)).AND.(PHS.LT.VH( 4))) THEN
         IF (PHSP(IC,IWL).LT.PHSV) LDF(3)=0
         PHSV=PHSP(IC,IWL)
         CALL VINTER(PHS,VLIGHT,VLC,PSJ,VCLC,SMC,SME,LDF(3),NRY3,LV(3)
     $   ,KSP,KPT,3,KCT,NOUT1)
         GO TO 68
      END IF
      IF ((PHS.GE.VH( 4)).AND.(PHS.LT.VH( 5))) THEN
         IF (PHSP(IC,IWL).LT.PHSV) LDF(4)=0
         PHSV=PHSP(IC,IWL)
         CALL VINTER(PHS,VLIGHT,VLC,PSJ,VCLC,SMC,SME,LDF(4),NRY4,LV(4)
     $   ,KSP,KPT,4,KCT,NOUT1)
         GO TO 68
      END IF
      IF ((PHS.GE.VH( 5)).AND.(PHS.LT.VH( 6))) THEN
         IF (PHSP(IC,IWL).LT.PHSV) LDF(5)=0
         PHSV=PHSP(IC,IWL)
         CALL VINTER(PHS,VLIGHT,VLC,PSJ,VCLC,SMC,SME,LDF(5),NRY5,LV(5)
     $   ,KSP,KPT,5,KCT,NOUT1)
         GO TO 68
      END IF
      IF ((PHS.GE.VH( 6)).AND.(PHS.LT.VH( 7))) THEN
          IF (PHSP(IC,IWL).LT.PHSV) LDF(6)=0
          PHSV=PHSP(IC,IWL)
         CALL VINTER(PHS,VLIGHT,VLC,PSJ,VCLC,SMC,SME,LDF(6),NRY6,LV(6)
     $   ,KSP,KPT,6,KCT,NOUT1)
         GO TO 68
      END IF
      IF ((PHS.GE.VH( 7)).AND.(PHS.LT.VH( 8))) THEN
          IF (PHSP(IC,IWL).LT.PHSV) LDF(7)=0
          PHSV=PHSP(IC,IWL)
         CALL VINTER(PHS,VLIGHT,VLC,PSJ,VCLC,SMC,SME,LDF(7),NRY7,LV(7)
     $   ,KSP,KPT,7,KCT,NOUT1)
         GO TO 68
      END IF
      IF ((PHS.GE.VH( 8)).AND.(PHS.LT.VH( 9))) THEN
          IF (PHSP(IC,IWL).LT.PHSV) LDF(8)=0
          PHSV=PHSP(IC,IWL)
         CALL VINTER(PHS,VLIGHT,VLC,PSJ,VCLC,SMC,SME,LDF(8),NRY8,LV(8)
     $   ,KSP,KPT,8,KCT,NOUT1)
         GO TO 68
      END IF
      IF ((PHS.GE.VH( 9)).AND.(PHS.LT.VH(10))) THEN
         IF (PHSP(IC,IWL).LT.PHSV) LDF(9)=0
         PHSV=PHSP(IC,IWL)
         CALL VINTER(PHS,VLIGHT,VLC,PSJ,VCLC,SMC,SME,LDF(9),NRY9,LV(9)
     $   ,KSP,KPT,9,KCT,NOUT1)
         GO TO 68
      END IF
      IF ((PHS.GE.VH(10)).AND.(PHS.LT.VH(11))) THEN
          IF (PHSP(IC,IWL).LT.PHSV) LDF(10)=0
          PHSV=PHSP(IC,IWL)
         CALL VINTER(PHS,VLIGHT,VLC,PSJ,VCLC,SMC,SME,LDF(10),NRY10,
     $   LV(10),KSP,KPT,10,KCT,NOUT1)
         GO TO 68
      END IF
      IF ((PHS.GE.VH(11)).AND.(PHS.LT.VH(12))) THEN
         IF (PHSP(IC,IWL).LT.PHSV) LDF(11)=0
         PHSV=PHSP(IC,IWL)
         CALL VINTER(PHS,VLIGHT,VLC,PSJ,VCLC,SMC,SME,LDF(11),NRY11,
     $   LV(11),KSP,KPT,11,KCT,NOUT1)
         GO TO 68
      END IF
      IF ((PHS.GE.VH(12)).AND.(PHS.LT.VH(13))) THEN
         IF (DABS(VH(13)-PHS).LT.0.00000001D0) GO TO 67
         IF (PHSP(IC,IWL).LT.PHSV) LDF(12)=0
         PHSV=PHSP(IC,IWL)
         CALL VINTER(PHS,VLIGHT,VLC,PSJ,VCLC,SMC,SME,LDF(12),NRY12,
     $   LV(12),KSP,KPT,12,KCT,NOUT1)
         GO TO 68
      END IF
      IF (DABS(PHS-VH(13)).GT.0.00000001D0) CALL PMDSTOP
C
C     PHS coincides with final fiducial point
C
   67 VLIGHT = VCLC(LV(13))
C
C     *****************************************************************
C
   68 VLT=VLIGHT
      VLS=VLT
	IF(VLS.GT.VMXX) VMXX=VLS
      WRITE (NOUT16, 109) PHSP(IC,IWL),OBSL,VLS
  999 RETURN
  301 WRITE (NOUT1, 115) IC, IWL
      CALL PMDSTOP
      STOP
C     Reach here after reading EOF on input data tape
   70 KJP=1
      GO TO 999
      END
