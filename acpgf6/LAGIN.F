      SUBROUTINE LAGIN(VIN,VO,Y,Z,N1,N2,M,S) 
C     SRT FOR LAGRANGIAN INTERPOLATION
C     VIN IS INPUT VALUE,LYING WITHIN TABLE OF Y VALUES    
C     VO IS OUTPUT VALUE,INTERPOLATED WITHIN TABLE OF Z VALUES    
C     Y IS TABLE OF INDEPENDENT VARIABLE VALUES,LIMITED TO 10 ENTRIES    
C     Z IS TABLE OF DEPENDENT VARIABLE VALUES,LIMITED TO 10 ENTRIES      
C     N1 IS DEGREE OF POLYNOMIAL TO BE USED IN CALCULATING VO     
C     N2 IS NUMBER OF ENTRIES IN Y AND Z TABLES,LESS THAN OR EQUAL TO 10 
C     S IS SCALE FACTOR TO PERMIT LIMITED EXTRAPOLATION. CAN GO S TIMES  
C FIRST OR LAST Y INTERVAL BEYOND START OR END OF TABLE    
C     IF DEGREE OF POLYNOMIAL+1 EXCEEDS NUMBER OF TABLE ENTRIES,  
C RETURN WITH VO=0.0,M=1
C     IF NUMBER OF TABLE ENTRIES EXCEEDS 10,RETURN WITH VO=0.0,M=1
C     IF VIN=Y(I),RETURN WITH VO=Z(I),M=5    
C     IF NUMBER OF TABLE ENTRIES IS .LE. 2,RETURN WITH VO=0.0,M=1 
C     IF VIN LIES TO LEFT OF PERMITTED INITIAL POINT,RETURN WITH VO=0.0, 
C M=0     
C     IF START WITH FIRST POINT ON LIST IN CONSTRUCTING POLYNOMIAL,      
C RETURN WITH M=6
C     IF START WITH PT. 1/2 N1 POINTS BACK FROM Y(I) FOLLOWING VIN,      
C RETURN WITH M=3
C     IF USE LAST N1 POINTS IN LIST,IN CONSTRUCTING POLYNOMIAL,   
C RETURN WITH M=4
C     IF VIN LIES TO RIGHT OF PERMITTED END POINT,RETURN WITH VO=0.0,M=2 
C  
C     M=0,1,OR 2 ON RETURN IMDICATES AN ERROR
C  
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION Y(10), Z(10)   
      EQUIVALENCE (KK,KL),(DN,DD)     
      IF (N2-N1-1) 40,1,1      
    1 IF (N2-10) 17,17,40      
   17 IF (N2-2) 40,40,22
   22 DO 21 I=2,N2      
      IF ((VIN.GE.Y(I-1)).AND.(VIN.LE.Y(I))) GO TO 4
      IF ((VIN.LE.Y(I-1)).AND.(VIN.GE.Y(I))) GO TO 4
   21 CONTINUE   
   35 I=1 
      CF=(Y(2)-Y(1))/DABS(Y(2)-Y(1))   
      IF (CF*(Y(I)-VIN)) 2,41,30      
   30 IF (CF*(Y(I)-VIN)+S*DABS(Y(I+1)-Y(I))) 4,4,42  
C     FIND Y(I) ENTRY FOLLOWING VIN   
    2 DO 3 I=2,N2
      IF (CF*(Y(I)-VIN)) 3,41,4
    3 CONTINUE   
      IF (CF*(Y(N2)-VIN)+S*DABS(Y(N2)-Y(N2-1))) 43,4,4      
    4 IQ= MOD (N1,2)    
      IF (IQ) 14,14,15  
C     ARRIVE HERE IF EVEN NO. OF POINTS IN POLYNOMIAL APPROX.     
   14 L1=N1/2    
      L2=N1/2    
      GO TO 16   
C     ARRIVE HERE IF ODD NO. OF POINTS IN POLYNOMIAL APPROX.      
   15 L1=N1/2+1  
      L2=N1/2    
   16 IF(I-L1) 5,5,6    
C     START APPROX. WITH FIRST POINT ON LIST 
    5 I=1 
      M=6 
      GO TO 8    
    6 IF (I+L2-N2) 12,12,7     
C     USE LAST N1 POINTS IN LIST      
    7 I=N2-N1    
      M=4 
      GO TO 8    
C     START APPROX. 1/2 N1 POINTS BACK
   12 I=I-L1     
      M=3 
      GO TO 8    
C     INITIALIZE VO,SET COUNTER FOR ORDINAL LOC. OF FINAL POINT   
    8 VO=0.D0
      II=I+N1    
C     K DESIGNATES A PARTICULAR POLYNOMIAL RATIO IN SERIES 
      DO 9 K=I,II
      A=1.D0    
      B=1.D0     
      KK=K-1     
      IF (KK-I) 19,18,18
   18 DO 10 J=I,KK      
      DN=VIN-Y(J)
      A=A*DN     
      DD=Y(K)-Y(J)      
      B=B*DD     
   10 CONTINUE   
   19 KL=K+1     
      IF (KL.GT.II) GO TO 9    
C     PRODUCE POLYNOMIAL TERMS FOLLOWING POINT K    
   20 DO 11 J=KL,II     
      DN=VIN-Y(J)
      A=A*DN     
      DD=Y(K)-Y(J)      
      B=B*DD     
   11 CONTINUE   
    9 VO=VO+(A/B)*Z(K)  
   13 RETURN     
   40 VO=0.D0     
      M=1 
      GO TO 13   
   41 VO=Z(I)    
      M=5 
      GO TO 13   
   42 VO=0.D0    
      M=0 
      GO TO 13   
   43 VO=0.D0    
      M=2 
      GO TO 13   
      END 
