      PROGRAM PGH14
	USE MSFLIB
C     Program to combine partial derivative of binary star system
C     light with respect to the several system parameters and write
C     a single file containing the various derivatives.
C     This program applies to PGC parameters
      INCLUDE 'COMA.FOR'
	INCLUDE 'COMM.FOR'
	DIMENSION FL1(11)
	COMMON /NUNIT/ NU, NUOUT, IFOUT
	CHARACTER * 24 FL1
      INTEGER (4) RESULT
	INTEGER (2)	IYR,IMON,IDAY,IHR,IMIN,ISEC,I100TH
C**********************************************************************
      DATA IN1,IN2/1,2/
	DATA NOUT1,NOUT2/3,4/
	DATA KSC1,KSC2,KSC3,KSC4,KSC5,KSC6,NSC/5,6,7,8,9,10,11/
	DATA KEYBAD/-1/
	DATA KEYGOOD/0/
C**********************************************************************
  100 FORMAT (A24)
  101 FORMAT (I2)
  102 FORMAT (1H )
  103 FORMAT (1H1)
  104 FORMAT (1X,'PROGRAM PGH14',28X,'DATE=',I2,'/',I2,'/',I4,
     $2X,'TIME=',I2,':',I2,':',I2,'.',I2,/,13X,
     $'**OUT**',/,1X,'*')
  105 FORMAT (1X,'NUMBER OF VALUES OF ORBITAL LONGITUDE=',I5)
  106 FORMAT (10I5)
  123 FORMAT (6D20.12)
  126 FORMAT (6D20.13)
  514 FORMAT (1X,F8.5,I5,F10.5,8E12.5)
C**********************************************************************

      RESULT=SETEXITQQ(QWIN$EXITNOPERSIST)
	OPEN (UNIT=     12, FILE='C:\LGTSYN\PGH14\PGH14.ILS',STATUS='OLD')
	READ (12, 100)      (FL1(J),J=1,11)
	OPEN (UNIT =IN1, FILE=FL1(1), STATUS='OLD')
	WRITE (IN1,101) KEYBAD
	REWIND IN1
	OPEN (UNIT =IN2,   FILE=FL1(2), STATUS='OLD')
	OPEN (UNIT =NOUT1, FILE=FL1(3), STATUS='REPLACE')
	OPEN (UNIT =NOUT2, FILE=FL1(4), STATUS='REPLACE')
	OPEN (UNIT = KSC1, FILE=FL1(5), STATUS='OLD')
	OPEN (UNIT = KSC2, FILE=FL1(6), STATUS='OLD')
	OPEN (UNIT = KSC3, FILE=FL1(7), STATUS='OLD')
	OPEN (UNIT = KSC4, FILE=FL1(8), STATUS='OLD')
	OPEN (UNIT = KSC5, FILE=FL1(9), STATUS='OLD')
	OPEN (UNIT = KSC6, FILE=FL1(10),STATUS='OLD')
	OPEN (UNIT =  NSC, FILE=FL1(11),STATUS='REPLACE')
C**********************************************************************
      CALL GETDAT (IYR,IMON,IDAY)
	CALL GETTIM (IHR,IMIN,ISEC,I100TH)
	WRITE (NOUT1,103)
	WRITE (NOUT1,104)IMON,IDAY,IYR,IHR,IMIN,ISEC,I100TH
	CALL RDWT2(NT,NU,NTH,I,IEC,SL,OMRAD,ECC,VMNAN,VECAN,VTRUE,
     $VRD,PSIP,KCTRL,KFORM,IN2)
	DO 24 KS=1,10000
	READ (KSC1,123,END=26,ERR=999) PHAS1,TE1,DVTE1,SMTE1,D1M1TE1
	PHASE=PHAS1
	READ (KSC2,123) PHAS2,TE2,DVTE2,SMTE2,D1M1TE2
	IF ((PHAS2-PHAS1).GT.1.D-10) CALL PMDSTOP
	READ (KSC3,123) PHAS3,A1,DVA1,SMA1,D1M1A1
	IF ((PHAS3-PHAS1).GT.1.D-10) CALL PMDSTOP
	READ (KSC4,123) PHAS4,A2,DVA2,SMA2,D1M1A2
	IF ((PHAS4-PHAS1).GT.1.D-10) CALL PMDSTOP
	READ (KSC5,123) PHAS5,BCF1,DVBCF1,SMBCF1,D1M1B1
	IF ((PHAS5-PHAS1).GT.1.D-10) CALL PMDSTOP
	READ (KSC6,123) PHAS6,BCF2,DVBCF2,SMBCF2,D1M1B2
	IF ((PHAS6-PHAS1).GT.1.D-10) CALL PMDSTOP
	WRITE (NSC,123) PHASE,TE1,DVTE1,SMTE1,D1M1TE1,
     $TE2,DVTE2,SMTE2,D1M1TE2,
     $A1,DVA1,SMA1,D1M1A1,
     $A2,DVA2,SMA2,D1M1A2,
     $BCF1,DVBCF1,SMBCF1,D1M1B1,
     $BCF2,DVBCF2,SMBCF2,D1M1B2
   24 CONTINUE
   26 NPSI=KS-1
      REWIND NSC
      DO 25 KS=1,NPSI
      READ (NSC,123) PHASE,TE1,DVTE1,SMTE1,D1M1TE1,
     $TE2,DVTE2,SMTE2,D1M1TE2,
     $A1,DVA1,SMA1,D1M1A1,
     $A2,DVA2,SMA2,D1M1A2,
     $BCF1,DVBCF1,SMBCF1,D1M1B1,
     $BCF2,DVBCF2,SMBCF2,D1M1B2
	WRITE (NOUT2,123) PHASE,TE1,DVTE1,SMTE1,D1M1TE1,
     $TE2,DVTE2,SMTE2,D1M1TE2,
     $A1,DVA1,SMA1,D1M1A1,
     $A2,DVA2,SMA2,D1M1A2,
     $BCF1,DVBCF1,SMBCF1,D1M1B1,
     $BCF2,DVBCF2,SMBCF2,D1M1B2
   25 CONTINUE
   90 CONTINUE
      CLOSE (UNIT = IN2,   STATUS = 'KEEP')
	CLOSE (UNIT = NOUT1, STATUS = 'KEEP')
	CLOSE (UNIT = NOUT2, STATUS = 'KEEP')
	CLOSE (UNIT =  KSC1, STATUS = 'KEEP')
	CLOSE (UNIT =  KSC2, STATUS = 'KEEP')
	CLOSE (UNIT =  KSC3, STATUS = 'KEEP')
	CLOSE (UNIT =  KSC4, STATUS = 'KEEP')
	CLOSE (UNIT =  KSC5, STATUS = 'KEEP')
	CLOSE (UNIT =  KSC6, STATUS = 'KEEP')
	CLOSE (UNIT =   NSC, STATUS ='DELETE')
	WRITE (IN1,101) KEYGOOD
	CLOSE (UNIT =   IN1, STATUS = 'KEEP')
   38 STOP
  999 CALL PMDSTOP
      END PROGRAM PGH14
