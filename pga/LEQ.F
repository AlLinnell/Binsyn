      SUBROUTINE LEQ (A,B,N,M,IA,IB,DET)
	IMPLICIT DOUBLE PRECISION (A-H,O-Z)
	DIMENSION A(IA,IA),B(IB,1)
	REAL*8 H1(6),H2(6),H3(6)
	DATA ERLT/1.D-14/
	DATA H1/8H NEAR SI,8HNGULAR S,8HYSTEM. C,8HALCULATI,
     1  8HON CONTI,8HNUED.   /
	DATA H2/8H LEQ  SI,8HNGULAR S,8HYSTEM. N,8HO UNIQUE,
     1  8H SOL. RA,8HNK .GE. /
	DATA H3/8H LEQ  AR,8HRAYS DIM,8HEN. INCO,8HRRECTLY ,
     1  8HOR INDIC,8HES.LE.0 /
CIF M=0 FIND DETERMINANT OF A ONLY.
CIF M.GT. 0 SOLVE LINEAR SYSTEM AX=B.
      IF (N.GT.IA.OR.N.GT.IB.OR.N.LE.0.) GO TO 115
CSCALE INPUT ARRAYS SO LARGEST ELEMENT IN EACH ROW OF A APPROX 1.
	DET=1.0D0
      DO 35 I=1,N
CFIND LARGEST ELEMENT IN I-TH ROW OF A.A
      T=0.0D0
      DO 10 J=1,N
      S=DABS(A(I,J))
      IF (T-S) 5,10,10
    5 T=S
   10 CONTINUE
      IF (T) 110,110,15
CSCALE I-TH ROWS OF A AND B.
15	ITT=INT(DLOG10(T))
	T=10.D0**(ITT)
	IF(DET.LE.0.0D0) GO TO 110
	IF(DET.LE.0.10D0) GO TO 16
	TST=1.D37/DET
	IF(TST.LT.T) DET=1.0D0
16	CONTINUE
      DET=DET*T
      T=1.0D0/T
      DO 20 J=1,N
   20 A(I,J)=T*A(I,J)
      IF (M) 35,35,25
   25 DO 30 J=1,M
   30 B(I,J)=B(I,J)*T
   35 CONTINUE
CBEGIN TRIANGULAR DECOMPOSITION TO L U FORM.
      DO 95 I=1,N
      IM1=I-1
CFIND LARGEST ELEMEMT IN I-TH COLUMN OF LOWER TRIANGLE OF A.
      T=DABS(A(I,I))
      IF (I.EQ.N) GO TO 80
      L=I
      IP1=I+1
      DO 40 J=IP1,N
      S=DABS(A(J,I))
      IF (S.LE.T) GO TO 40
      T=S
      L=J
   40 CONTINUE
      IF (DABS(T).LE.ERLT) GO TO 110
      IF (T.LT.1.D-14) PRINT 120, H1
      IF (L.EQ.I) GO TO 55
CIF LARGEST MAG. ELEMENT NOT ON DIAGONAL, INTERCHANGE ROWS.
      DET=-DET
      DO 45 J=1,N
      S=A(I,J)
      A(I,J)=A(L,J)
   45 A(L,J)=S
      IF (M.LE.0) GO TO 55
      DO 50 J=1,M
      S=B(I,J)
      B(I,J)=B(L,J)
   50 B(L,J)=S
   55 DO 75 J=IP1,N
      S2=0.D0
      IF (IM1.EQ.0) GO TO 65
      DO 60 K=1,IM1
   60 S2=S2+A(I,K)*A(K,J)
   65 S=S2
      A(I,J)=(A(I,J)-S)/A(I,I)
      S2=0.D0
      DO 70 K=1,I
   70 S2=S2+A(J,K)*A(K,IP1)
      S=S2
   75 A(J,IP1)=A(J,IP1)-S
   80 IF (DABS(T).LE.ERLT) GO TO 110
      DET=DET*A(I,I)
      IF (M.LE.0) GO TO 95
      DO 90 J=1,M
      S=0.
      IF (IM1.EQ.0) GO TO 90
      S2=0.D0
      DO 85 K=1,IM1
   85 S2=S2+A(I,K)*B(K,J)
      S=S2
   90 B(I,J)=(B(I,J)-S)/A(I,I)
   95 CONTINUE
      IF (N.EQ.1) RETURN
      IF (M.LE.0) RETURN
      NM1=N-1
      DO 105 I=1,M
      DO 105 J=1,NM1
      NMJ=N-J
      S2=0.D0
      NMJP1=NMJ+1
      DO 100 K=NMJP1,N
  100 S2=S2+A(NMJ,K)*B(K,I)
      S=S2
  105 B(NMJ,I)=B(NMJ,I)-S
      RETURN
  110 I=I-1
      PRINT 120, H2
	PRINT 130,I
      DET=0.D0
      RETURN
  115 PRINT 120, H3
C
  120 FORMAT (1H0,9X,6A8)   
130	FORMAT(1H0,5X,I3)
      RETURN
      END
