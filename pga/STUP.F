      SUBROUTINE STUP(I,KL,ER,FL,QS,VMI,RI,VVI,VVJ,QN,KC,NOUT1)
C      SRT TO CALCULATE CRITICAL PARAMETERS OF POTENTIALS FOR TWO STARS
C      I IS THE STELLAR COMPONENT INITIALLY UNDER CONSIDERATION,NORMALLY
C      COMPONENT 1
C      KL IS THE LIMIT ON THE NUMBER OF ITERATIONS PERMITTED IN SRT POTN
C      ER IS THE ACCURACY DEMANDED IN SRT POTN
C      FL IS THE FILLING FACTOR IN OVERCONTACT SYSTEM
C      QS IS THE MASS RATIO,IN THE SENSE   MASS(3-I)/MASS(I)
C      VMI IS THE MASS OF STAR I,IN GRAMS
C      RI IS THE SEPARATION OF CENTERS,IN CM.
C      VVI IS THE GRAVITATIONAL POTENTIAL OF STAR I
C      VVJ IS THE GRAVITATIONAL POTENTIAL OF STAR (3-I)
C      QN IS THE COMPLIMENTARY MASS RATIO,THE RECIPROCAL OF QS
C      KC IS A CONTROL INTEGER
C  IF KC=0,THE SYSTEM IS OVERCONTACT OR BARELY CONTACT
C  IF KC.NE.0,THE SYSTEM IS DETACHED OR SEMIDETACHED
      INCLUDE 'COMA.FOR'
      INCLUDE 'COMM.FOR'
      FL=0.D0
      QN=1.D0/QS
C      FILL VL(I,1),XMN(I),XMN(3-I),OMC(I,1),VL(I,2),OMC(I,2),ETC.
C      CALCULATE CRITICAL POTENTIALS THROUGH L1 POINT AND L2 POINT
      CALL SETLAG(I,ER,KL)
C     ASSUME SYSTEM IS DETACHED OR SEMIDETACHED
      KC=1
      IF (M(2).EQ.2) GO TO 1
C     TEST FOR OVERCONTACT CONDITION
      IF ((OM(I).LT.OMC(I,1)).AND.(OM(3-I).LT.OMC(3-I,1))) KC=0
C      CALCULATE FILLING FACTOR,FL
      FL=(OMC(I,1)-OM(I))/(OMC(I,1)-OMC(I,2))
      IF (FL.LT.0.D0) FL=0.D0
      IF (KC.NE.0) GO TO 1
C      FILL XMN(I),XMN(3-I),YMN,ZMN,ALMX(I),ALMX(3-I),ALMY(I),ALMY(3-I),
C      FOR CONTACT SYSTEMS
      CALL POTN(I,ER,KL,NOUT1)
C  ****
   5   RETURN
C      DETACHED OR SEMI-DETACHED BEYOND HERE
C      NOTE THAT VALUES IN LOCATION  500 MAY BE OVERWRITTEN LATER IN PGA
C      AND DO NOT LIMIT THE EFFECTIVE STORAGE AREA
   1  ALMX(I)=1.D0
      ALMX(3-I)=1.D0
      ALMY(I)=1.D0
      ALMY(3-I)=1.D0
      YMN=0.D0
      ZMN=0.D0
	SV1=VR(I,1,1)
	SV2=VR(3-I,1,1)
	SV3=ALM(I,1,1)
	SV4=ALM(3-I,1,1)
	SV5=AMU(I,1,1)
	SV6=AMU(3-I,1,1)
   3  ALM(I,1,1)=1.D0
      ALM(3-I,1,1)=1.D0
      AMU(I,1,1)=0.D0
      AMU(3-I,1,1)=0.D0
      ANU(I,1,1)=0.D0
      ANU(3-I,1,1)=0.D0
      IF (M(2).EQ.2) GO TO 5
   6  CALL RCHER(I,1,1,ER)
      XMN(I)=VR(I,1,1)
      Q=QN
      CALL RCHER(3-I,1,1,ER)
      XMN(3-I)=VR(3-I,1,1)
	VR(I,1,1)=SV1
	VR(3-I,1,1)=SV2
	ALM(I,1,1)=SV3
	ALM(3-I,1,1)=SV4
	AMU(I,1,1)=SV5
	AMU(3-I,1,1)=SV6
      Q=QS
      GO TO 5
      END
      
